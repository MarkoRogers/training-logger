<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Training Logger</title>
<style>
/* Basic styles - keeping your original theme */
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #1a1a2e; color: #e0e0e0; margin: 0; padding: 0; }
.container { max-width: 1200px; margin: auto; padding: 20px; }
.header { text-align:center; padding:30px; background: rgba(255,255,255,0.05); border-radius:15px; margin-bottom:20px; }
.nav { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-bottom:20px; }
.nav-btn { padding:12px 25px; border:none; border-radius:25px; cursor:pointer; font-weight:bold; background: #667eea; color:white; transition:0.3s; }
.nav-btn.active { background: #00d4ff; }
.nav-btn:hover { transform:translateY(-2px); }
.tab-content { display:none; padding:20px; background: rgba(255,255,255,0.05); border-radius:15px; }
.tab-content.active { display:block; }
.form-group { margin-bottom:15px; }
.form-group label { display:block; margin-bottom:5px; color:#00d4ff; }
.form-group input, .form-group textarea { width:100%; padding:8px; border-radius:5px; border:1px solid rgba(255,255,255,0.2); background:rgba(255,255,255,0.1); color:#e0e0e0; }
.btn { padding:10px 20px; border:none; border-radius:5px; cursor:pointer; margin:5px; background:#667eea; color:white; }
.btn:hover { transform:translateY(-1px); }
.btn-success { background:#11998e; }
.btn-danger { background:#ff416c; }
.exercise-card { background: rgba(255,255,255,0.1); border-radius:10px; padding:15px; margin-bottom:10px; }
.set-row { display:grid; grid-template-columns:60px 80px 80px 80px 1fr 60px; gap:5px; align-items:center; margin-bottom:5px; }
.set-input { padding:5px; border-radius:5px; border:1px solid rgba(255,255,255,0.2); background:rgba(255,255,255,0.1); color:#e0e0e0; text-align:center; }
.video-preview { width:300px; margin:5px; border-radius:5px; }
.modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:1000; }
.modal-content { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:#1a1a2e; padding:20px; border-radius:15px; max-width:90%; max-height:90%; overflow-y:auto; border:1px solid rgba(255,255,255,0.2);}
.close { float:right; cursor:pointer; color:#aaa; font-size:25px; }
.close:hover { color:white; }
.search-bar { width:100%; padding:10px; border-radius:25px; border:1px solid rgba(255,255,255,0.2); margin-bottom:10px; background: rgba(255,255,255,0.1); color:#e0e0e0; }
</style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>Training Logger</h1>
        <p>Track your workouts, analyze progress, optimize performance</p>
    </div>

    <nav class="nav">
        <button class="nav-btn active" onclick="showTab('programs')">Programs</button>
        <button class="nav-btn" onclick="showTab('workout')">Current Workout</button>
        <button class="nav-btn" onclick="showTab('history')">History</button>
        <button class="nav-btn" onclick="showTab('stats')">Analytics</button>
    </nav>

    <!-- Programs Tab -->
    <div id="programs" class="tab-content active">
        <button class="btn btn-success" onclick="createProgram()">Create New Program</button>
        <input type="text" class="search-bar" placeholder="Search programs..." oninput="searchPrograms(this.value)">
        <div id="programList"></div>
    </div>

    <!-- Current Workout -->
    <div id="workout" class="tab-content">
        <h2>Current Workout</h2>
        <div id="currentProgram"><p>Select a program to start</p></div>
        <div class="form-group">
            <label>Session Notes</label>
            <textarea id="sessionNotes" rows="4"></textarea>
        </div>
        <div class="video-upload">
            <h3>Upload Videos</h3>
            <input type="file" id="videoUpload" accept="video/*" multiple>
            <div id="videoPreview"></div>
        </div>
        <button class="btn btn-success" onclick="saveWorkout()">Save Workout</button>
    </div>

    <!-- History -->
    <div id="history" class="tab-content">
        <h2>Workout History</h2>
        <input type="text" class="search-bar" placeholder="Search history..." oninput="searchHistory(this.value)">
        <div id="historyList"></div>
    </div>

    <!-- Analytics -->
    <div id="stats" class="tab-content">
        <h2>Analytics</h2>
        <div id="personalRecords"></div>
        <div id="frequencyAnalysis"></div>
    </div>

    <!-- Modal -->
    <div id="programModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">Create Program</h2>
            <div class="form-group">
                <label>Program Name</label>
                <input type="text" id="programName">
            </div>
            <div class="form-group">
                <label>Description</label>
                <textarea id="programDescription" rows="3"></textarea>
            </div>
            <h3>Exercises</h3>
            <div id="exerciseList"></div>
            <button class="btn" onclick="addExercise()">Add Exercise</button>
            <button class="btn btn-success" onclick="saveProgram()">Save Program</button>
        </div>
    </div>
</div>

<script>
let programs = [];
let workoutHistory = [];
let currentProgramIndex = -1;
let currentWorkout = null;

// IndexedDB for videos
let db;
const request = indexedDB.open("TrainingLoggerDB",1);
request.onupgradeneeded = e => {
    db = e.target.result;
    if(!db.objectStoreNames.contains("videos")) db.createObjectStore("videos",{keyPath:"id",autoIncrement:true});
}
request.onsuccess = e => { db = e.target.result; }
request.onerror = e => { console.error(e); }

// Tabs
function showTab(name){
    document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
    document.getElementById(name).classList.add('active');
    document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
    event.target.classList.add('active');
}

// Storage
function savePrograms(){ localStorage.setItem('programs',JSON.stringify(programs)); }
function saveHistory(){ localStorage.setItem('workoutHistory',JSON.stringify(workoutHistory)); }
function loadData(){
    programs = JSON.parse(localStorage.getItem('programs')||"[]");
    workoutHistory = JSON.parse(localStorage.getItem('workoutHistory')||"[]");
}
loadData();

// Program modal
function createProgram(){
    currentProgramIndex=-1;
    document.getElementById('modalTitle').textContent='Create Program';
    document.getElementById('programName').value='';
    document.getElementById('programDescription').value='';
    document.getElementById('exerciseList').innerHTML='';
    document.getElementById('programModal').style.display='block';
}
function closeModal(){ document.getElementById('programModal').style.display='none'; }
function addExercise(){
    const container=document.getElementById('exerciseList');
    const div=document.createElement('div'); div.className='exercise-card';
    div.innerHTML=`
        <div class="form-group"><label>Name</label><input type="text" class="exercise-name"></div>
        <div class="form-group"><label>Sets</label><input type="number" class="exercise-sets" value="3"></div>
        <div class="form-group"><label>Reps</label><input type="text" class="exercise-reps" value="6-8"></div>
        <div class="form-group"><label>RPE</label><input type="number" class="exercise-rpe" value="8" step="0.5" min="1" max="10"></div>
        <div class="form-group"><label>Rest(sec)</label><input type="number" class="exercise-rest" value="180"></div>
        <div class="form-group"><label>Notes</label><textarea class="exercise-notes"></textarea></div>
        <button class="btn btn-danger" onclick="this.parentNode.remove()">Remove</button>
    `;
    container.appendChild(div);
}
function saveProgram(){
    const name=document.getElementById('programName').value.trim();
    if(!name) return alert("Name required");
    const desc=document.getElementById('programDescription').value;
    const exercises=[...document.querySelectorAll('#exerciseList .exercise-card')].map(ex=>({
        name:ex.querySelector('.exercise-name').value,
        sets:parseInt(ex.querySelector('.exercise-sets').value),
        reps:ex.querySelector('.exercise-reps').value,
        rpe:parseFloat(ex.querySelector('.exercise-rpe').value),
        rest:parseInt(ex.querySelector('.exercise-rest').value),
        notes:ex.querySelector('.exercise-notes').value
    }));
    const program={name,description:desc,exercises};
    if(currentProgramIndex>=0) programs[currentProgramIndex]=program; else programs.push(program);
    savePrograms(); closeModal(); renderPrograms();
}
function renderPrograms(filter=""){
    const list=document.getElementById('programList'); list.innerHTML='';
    programs.filter(p=>p.name.toLowerCase().includes(filter.toLowerCase())).forEach((p,i)=>{
        const div=document.createElement('div'); div.className='program-card';
        div.innerHTML=`<h3>${p.name}</h3><p>${p.description}</p>
            <button class="btn" onclick="editProgram(${i})">Edit</button>
            <button class="btn btn-success" onclick="startWorkout(${i})">Start</button>
            <button class="btn btn-danger" onclick="deleteProgram(${i})">Delete</button>`;
        list.appendChild(div);
    });
}
function editProgram(i){
    currentProgramIndex=i;
    const p=programs[i];
    document.getElementById('modalTitle').textContent='Edit Program';
    document.getElementById('programName').value=p.name;
    document.getElementById('programDescription').value=p.description;
    const container=document.getElementById('exerciseList'); container.innerHTML='';
    p.exercises.forEach(ex=>{
        addExercise();
        const last=container.lastChild;
        last.querySelector('.exercise-name').value=ex.name;
        last.querySelector('.exercise-sets').value=ex.sets;
        last.querySelector('.exercise-reps').value=ex.reps;
        last.querySelector('.exercise-rpe').value=ex.rpe;
        last.querySelector('.exercise-rest').value=ex.rest;
        last.querySelector('.exercise-notes').value=ex.notes;
    });
    document.getElementById('programModal').style.display='block';
}
function deleteProgram(i){ if(confirm("Delete?")){ programs.splice(i,1); savePrograms(); renderPrograms(); } }
function searchPrograms(q){ renderPrograms(q); }

// Workout
function startWorkout(i){
    currentProgramIndex=i;
    currentWorkout={...programs[i],exercises:programs[i].exercises.map(e=>({...e,completedSets:Array(e.sets).fill({weight:"",reps:"",rpe:"",notes:""})}))};
    renderCurrentWorkout();
    showTab('workout');
}
function renderCurrentWorkout(){
    const div=document.getElementById('currentProgram'); div.innerHTML='';
    currentWorkout.exercises.forEach((ex,i)=>{
        const exDiv=document.createElement('div'); exDiv.className='exercise-card';
        exDiv.innerHTML=`<h4>${ex.name}</h4>`;
        ex.sets.forEach((s,j)=>{
            const row=document.createElement('div'); row.className='set-row';
            row.innerHTML=`
                <input class="set-input" placeholder="Weight" value="${s.weight||''}" onchange="updateSet(${i},${j},'weight',this.value)">
                <input class="set-input" placeholder="Reps" value="${s.reps||''}" onchange="updateSet(${i},${j},'reps',this.value)">
                <input class="set-input" placeholder="RPE" value="${s.rpe||''}" onchange="updateSet(${i},${j},'rpe',this.value)">
                <input class="set-input" placeholder="Notes" value="${s.notes||''}" onchange="updateSet(${i},${j},'notes',this.value)">
            `;
            exDiv.appendChild(row);
        });
        div.appendChild(exDiv);
    });
    renderVideoPreview();
}
function updateSet(exI,setI,field,value){ currentWorkout.exercises[exI].completedSets[setI][field]=value; }

document.getElementById('videoUpload').addEventListener('change',function(e){
    const files=[...e.target.files];
    const transaction = db.transaction("videos","readwrite");
    const store=transaction.objectStore("videos");
    files.forEach(file=>{ store.add({name:file.name,file}); });
    transaction.oncomplete=()=>{ renderVideoPreview(); alert("Videos saved!"); }
});
function renderVideoPreview(){
    const container=document.getElementById('videoPreview'); container.innerHTML='';
    const transaction=db.transaction("videos","readonly").objectStore("videos").openCursor();
    transaction.onsuccess=e=>{
        const cursor=e.target.result;
        if(cursor){
            const v=cursor.value;
            const video=document.createElement('video'); video.className='video-preview'; video.controls=true;
            const url=URL.createObjectURL(v.file);
            video.src=url; container.appendChild(video);
            cursor.continue();
        }
    };
}
function saveWorkout(){
    if(!currentWorkout) return;
    const notes=document.getElementById('sessionNotes').value;
    workoutHistory.push({date:new Date().toISOString(),program:currentWorkout.name,exercises:currentWorkout.exercises,notes});
    saveHistory();
    alert("Workout saved!");
    document.getElementById('sessionNotes').value='';
}

// History
function renderHistory(filter=""){
    const list=document.getElementById('historyList'); list.innerHTML='';
    workoutHistory.filter(h=>h.program.toLowerCase().includes(filter.toLowerCase())).forEach(h=>{
        const div=document.createElement('div'); div.className='history-item';
        div.innerHTML=`<h4>${h.program} (${new Date(h.date).toLocaleString()})</h4><p>${h.notes}</p>`;
        list.appendChild(div);
    });
}
function searchHistory(q){ renderHistory(q); }

// Initial render
renderPrograms();
renderHistory();
</script>
</body>
</html>

