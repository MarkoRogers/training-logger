<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Training Logger</title>
<style>
* {margin:0; padding:0; box-sizing:border-box;}
body {font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#121212; color:#eee;}
.container {max-width:1200px; margin:0 auto; padding:20px;}
.header {text-align:center; margin-bottom:20px;}
.header h1 {font-size:2.5em; color:#00d4ff; margin-bottom:5px;}
.nav {display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin-bottom:20px;}
.nav-btn {padding:10px 20px; border:none; border-radius:20px; background:#667eea; color:#fff; cursor:pointer;}
.nav-btn.active {background:#00d4ff;}
.tab-content {display:none; background:#1c1c2e; padding:20px; border-radius:15px;}
.tab-content.active {display:block;}
.btn {padding:10px 20px; margin:5px; border:none; border-radius:8px; cursor:pointer;}
.btn-success {background:#11998e; color:#fff;}
.btn-danger {background:#ff416c; color:#fff;}
.form-group {margin-bottom:15px;}
.form-group label {display:block; margin-bottom:5px; color:#00d4ff;}
.form-group input, .form-group textarea {width:100%; padding:8px; border-radius:5px; border:none; background:#333; color:#eee;}
.exercise-card {background:#222; padding:15px; border-radius:10px; margin-bottom:10px;}
.set-row {display:grid; grid-template-columns:50px 70px 70px 70px 1fr 50px; gap:5px; align-items:center; margin-bottom:5px;}
.set-input {width:100%; padding:5px; border-radius:5px; border:none; background:#333; color:#eee; text-align:center;}
.video-preview {width:150px; margin:5px;}
.stats-grid {display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:20px; margin-top:20px;}
.stat-card {background:#222; padding:15px; border-radius:10px;}
table {width:100%; border-collapse:collapse;}
th,td {padding:5px; border:1px solid #444; text-align:center;}
th {background:#00d4ff; color:#000;}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>Training Logger</h1>
    <p>Track your workouts, analyze progress, optimize performance</p>
  </div>

  <div class="nav">
    <button class="nav-btn active" onclick="showTab('programs')">Programs</button>
    <button class="nav-btn" onclick="showTab('workout')">Current Workout</button>
    <button class="nav-btn" onclick="showTab('history')">History</button>
    <button class="nav-btn" onclick="showTab('stats')">Analytics</button>
  </div>

  <!-- Programs Tab -->
  <div id="programs" class="tab-content active">
    <button class="btn btn-success" onclick="createProgram()">Create Program</button>
    <div class="program-list" id="programList"></div>
  </div>

  <!-- Workout Tab -->
  <div id="workout" class="tab-content">
    <div id="currentWorkoutContainer"></div>
    <div class="video-upload">
      <h3>Session Videos</h3>
      <input type="file" id="videoUpload" accept="video/*" multiple onchange="handleVideoUpload(event)">
      <div id="videoPreview"></div>
    </div>
    <div class="form-group">
      <label>Session Notes</label>
      <textarea id="sessionNotes"></textarea>
    </div>
    <button class="btn btn-success" onclick="saveWorkout()">Save Workout</button>
  </div>

  <!-- History Tab -->
  <div id="history" class="tab-content">
    <div id="historyList"></div>
  </div>

  <!-- Analytics Tab -->
  <div id="stats" class="tab-content">
    <div class="stats-grid">
      <div class="stat-card">
        <h3>Personal Records</h3>
        <div id="prTable"></div>
      </div>
      <div class="stat-card">
        <h3>Exercise Frequency</h3>
        <div id="freqTable"></div>
      </div>
      <div class="stat-card">
        <h3>Total Volume</h3>
        <div id="volTable"></div>
      </div>
    </div>
  </div>

  <!-- Program Modal -->
  <div id="programModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);">
    <div style="background:#121212;padding:20px;border-radius:15px;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);max-height:90%;overflow:auto;">
      <span style="float:right;cursor:pointer;color:#fff;font-size:20px;" onclick="closeModal()">Ã—</span>
      <h2 id="modalTitle">Create Program</h2>
      <div class="form-group">
        <label>Program Name</label>
        <input type="text" id="programName">
      </div>
      <div class="form-group">
        <label>Program Description</label>
        <textarea id="programDesc"></textarea>
      </div>
      <div id="exerciseList"></div>
      <button class="btn" onclick="addExercise()">Add Exercise</button>
      <button class="btn btn-success" onclick="saveProgram()">Save Program</button>
    </div>
  </div>

</div>

<script>
let db;
let currentWorkout = null;
let programs = [];
let workoutHistory = [];
let sessionVideos = [];

function initDB() {
  const request = indexedDB.open('trainingDB',1);
  request.onerror = e=>console.error(e);
  request.onsuccess = e=>{
    db = e.target.result;
    loadPrograms();
    loadHistory();
    loadAnalytics();
  };
  request.onupgradeneeded = e=>{
    db = e.target.result;
    if(!db.objectStoreNames.contains('programs')) db.createObjectStore('programs',{keyPath:'id'});
    if(!db.objectStoreNames.contains('workouts')) db.createObjectStore('workouts',{keyPath:'id'});
    if(!db.objectStoreNames.contains('videos')) db.createObjectStore('videos',{keyPath:'id',autoIncrement:true});
  };
}

function saveProgram() {
  const name = document.getElementById('programName').value;
  const desc = document.getElementById('programDesc').value;
  const exercises = Array.from(document.querySelectorAll('#exerciseList .exercise-card')).map(card=>({
    name: card.querySelector('.exercise-name').value,
    sets: parseInt(card.querySelector('.sets-input').value),
    reps: card.querySelector('.reps-input').value,
    rpe: parseFloat(card.querySelector('.rpe-input').value)
  }));
  const id = Date.now();
  const tx = db.transaction('programs','readwrite');
  tx.objectStore('programs').put({id,name,desc,exercises});
  tx.oncomplete=()=>{loadPrograms(); closeModal();}
}

function loadPrograms() {
  const list = document.getElementById('programList');
  list.innerHTML='';
  const tx = db.transaction('programs','readonly');
  const store = tx.objectStore('programs');
  store.openCursor().onsuccess = e=>{
    const cursor = e.target.result;
    if(cursor){
      const prog = cursor.value;
      const div = document.createElement('div');
      div.className='exercise-card';
      div.innerHTML = `<h4>${prog.name}</h4><p>${prog.desc}</p>
        <button class="btn btn-success" onclick="startWorkout(${prog.id})">Start Workout</button>`;
      list.appendChild(div);
      cursor.continue();
    }
  }
}

function addExercise(){
  const exList = document.getElementById('exerciseList');
  const div = document.createElement('div');
  div.className='exercise-card';
  div.innerHTML=`<input class="exercise-name" placeholder="Exercise Name">
    <input class="sets-input" type="number" placeholder="Sets" value="3">
    <input class="reps-input" placeholder="Reps">
    <input class="rpe-input" type="number" placeholder="RPE" value="8">`;
  exList.appendChild(div);
}

function createProgram(){document.getElementById('programModal').style.display='block';}
function closeModal(){document.getElementById('programModal').style.display='none';}

function showTab(tab){document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));document.getElementById(tab).classList.add('active');document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));event.target.classList.add('active');}

function startWorkout(id){
  const tx = db.transaction('programs','readonly');
  tx.objectStore('programs').get(id).onsuccess=e=>{
    const prog = e.target.result;
    currentWorkout={id:Date.now(),progId:id,name:prog.name,date:new Date(),exercises:prog.exercises.map(ex=>({...ex,setsData:Array(ex.sets).fill({weight:'',reps:'',rpe:'',completed:false})}))};
    loadWorkoutUI();
    showTab('workout');
  }
}

function loadWorkoutUI(){
  const container=document.getElementById('currentWorkoutContainer'); container.innerHTML='';
  currentWorkout.exercises.forEach((ex,i)=>{
    const div=document.createElement('div'); div.className='exercise-card';
    let setsHTML='';
    ex.setsData.forEach((s,j)=>{setsHTML+=`<div class="set-row">
      <div>${j+1}</div>
      <input class="set-input" placeholder="Weight" onchange="updateSet(${i},${j},'weight',this.value)">
      <input class="set-input" placeholder="Reps" onchange="updateSet(${i},${j},'reps',this.value)">
      <input class="set-input" placeholder="RPE" onchange="updateSet(${i},${j},'rpe',this.value)">
      <input type="checkbox" onchange="updateSet(${i},${j},'completed',this.checked)">
    </div>`;});
    div.innerHTML=`<h4>${ex.name}</h4>${setsHTML}`; container.appendChild(div);
  });
}

function updateSet(exIndex,setIndex,field,value){currentWorkout.exercises[exIndex].setsData[setIndex][field]=field==='completed'?!!value:value;}

function handleVideoUpload(e){
  const files=Array.from(e.target.files);
  const preview=document.getElementById('videoPreview');
  preview.innerHTML='';
  files.forEach(f=>{
    const url=URL.createObjectURL(f);
    preview.innerHTML+=`<video controls src="${url}" class="video-preview"></video>`;
    const tx=db.transaction('videos','readwrite'); tx.objectStore('videos').put({workoutId:currentWorkout.id,file:f});
  });
}

function saveWorkout(){
  const tx=db.transaction(['workouts','videos'],'readwrite');
  tx.objectStore('workouts').put(currentWorkout);
  alert('Workout saved!');
  currentWorkout=null; document.getElementById('currentWorkoutContainer').innerHTML=''; document.getElementById('videoPreview').innerHTML='';
  loadHistory(); loadAnalytics();
}

function loadHistory(){
  const container=document.getElementById('historyList'); container.innerHTML='';
  const tx=db.transaction('workouts','readonly'); const store=tx.objectStore('workouts');
  store.openCursor().onsuccess=e=>{
    const cursor=e.target.result; if(cursor){const w=cursor.value;
      const div=document.createElement('div'); div.className='exercise-card';
      div.innerHTML=`<h4>${w.name}</h4><p>${new Date(w.date).toLocaleString()}</p>
        <button class="btn btn-success" onclick="viewWorkout(${w.id})">View</button>`;
      container.appendChild(div); cursor.continue();
    }
  }
}

function viewWorkout(id){
  const tx=db.transaction('workouts','readonly'); tx.objectStore('workouts').get(id).onsuccess=e=>{
    const w=e.target.result; let html=`<h3>${w.name}</h3><p>${new Date(w.date).toLocaleString()}</p>`;
    w.exercises.forEach(ex=>{html+=`<h4>${ex.name}</h4><table><tr><th>Set</th><th>Weight</th><th>Reps</th><th>RPE</th><th>Completed</th></tr>`;
      ex.setsData.forEach((s,i)=>{html+=`<tr><td>${i+1}</td><td>${s.weight}</td><td>${s.reps}</td><td>${s.rpe}</td><td>${s.completed}</td></tr>`;}); html+='</table>';
    }); document.getElementById('historyList').innerHTML=html;
  }
}

function loadAnalytics(){
  const prTable=document.getElementById('prTable'); prTable.innerHTML='';
  const freqTable=document.getElementById('freqTable'); freqTable.innerHTML='';
  const volTable=document.getElementById('volTable'); volTable.innerHTML='';
  const tx=db.transaction('workouts','readonly'); tx.objectStore('workouts').getAll().onsuccess=e=>{
    const allWorkouts=e.target.result;
    const pr={},freq={},vol={};
    allWorkouts.forEach(w=>{
      w.exercises.forEach(ex=>{
        freq[ex.name]= (freq[ex.name]||0)+1;
        ex.setsData.forEach(s=>{
          const weight=parseFloat(s.weight)||0, reps=parseFloat(s.reps)||0;
          vol[ex.name]=(vol[ex.name]||0)+weight*reps;
          pr[ex.name]=Math.max(pr[ex.name]||0,weight);
        });
      });
    });
    prTable.innerHTML=generateTable(['Exercise','PR'],pr);
    freqTable.innerHTML=generateTable(['Exercise','Frequency'],freq);
    volTable.innerHTML=generateTable(['Exercise','Total Volume'],vol);
  }
}

function generateTable(headers,obj){
  let html='<table><tr>'; headers.forEach(h=>html+=`<th>${h}</th>`); html+='</tr>';
  for(const key in obj){html+=`<tr><td>${key}</td><td>${obj[key]}</td></tr>`;}
  html+='</table>'; return html;
}

window.onload=initDB;
</script>
</body>
</html>
